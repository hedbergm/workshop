{% extends 'base.html' %}
{% block content %}
<section class="card">
  <h1>Bil: {{ v.regnr }}</h1>
  <div class="grid two">
    <div>
      <h3>Detaljer</h3>
      <ul class="kv">
        <li><b>Merke:</b> {{ v.make }}</li>
        <li><b>Type:</b> {{ v.vtype }}</li>
        <li><b>Modell:</b> {{ v.model }}</li>
        <li><b>Innkjøpspris:</b> {{ '%.0f'|format(v.purchase_price) if v.purchase_price is not none else '-' }}</li>
        <li><b>Sum kostnader:</b> {{ '%.0f'|format(total_cost) }}</li>
        <li><b>Utsalgspris:</b> {{ '%.0f'|format(v.sale_price) if v.sale_price is not none else '-' }}</li>
      </ul>
      <form method="post" action="{{ url_for('sell_vehicle', vehicle_id=v.id) }}" class="inline">
        <label>Utsalgspris
          <input name="sale_price" type="number" step="0.01" min="0" value="{{ v.sale_price if v.sale_price is not none else '' }}">
        </label>
        <button class="btn">Lagre utsalgspris</button>
      </form>
      <p><a class="btn" href="{{ url_for('list_vehicles') }}">Tilbake</a></p>
    </div>
    <div>
      <h3>Ny service/reparasjon</h3>
      <form method="post" action="{{ url_for('add_entry', vehicle_id=v.id) }}">
        <div class="grid two">
          <label>Dato
            <input type="date" name="date" value="{{ (v.created_at.date()|string) }}">
          </label>
          <label>Kategori
            <select name="category">
              <option value="service">Service</option>
              <option value="repair">Reparasjon</option>
            </select>
          </label>
          <label>Km-stand
            <input type="number" name="odometer" min="0" step="1">
          </label>
          <label>Kostnad (NOK)
            <input type="number" name="cost" min="0" step="0.01" required>
          </label>
        </div>
        <label>Beskrivelse
          <textarea name="description" rows="3" placeholder="Hva som er gjort"></textarea>
        </label>
        <div class="actions">
          <button type="submit" class="btn primary">Legg til</button>
        </div>
      </form>
    </div>
  </div>
</section>

<section class="card">
  <h2>Historikk</h2>
  <table class="table">
    <thead>
      <tr>
        <th>Dato</th>
        <th>Kategori</th>
        <th>Km</th>
        <th>Kostnad</th>
        <th>Beskrivelse</th>
      </tr>
    </thead>
    <tbody>
      {% for e in v.entries %}
      <tr>
        <td>{{ e.date }}</td>
        <td>{{ 'Service' if e.category == 'service' else 'Reparasjon' }}</td>
        <td>{{ e.odometer }}</td>
        <td>{{ '%.0f'|format(e.cost) }}</td>
        <td>{{ e.description }}</td>
      </tr>
      {% else %}
      <tr><td colspan="5">Ingen oppføringer enda.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
